<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>RChilli Resume Parser Demo</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 760px; margin: 2rem auto; }
      pre { background: #f6f8fa; padding: 1rem; overflow:auto; border-radius: 8px; }
      label, button { display:block; margin: 0.75rem 0; }
      #summary p { margin: .25rem 0; }
    </style>
  </head>
  <body>
    <h1>Upload Resume → Extract Data (RChilli)</h1>
    <form id="form">
      <input type="file" id="file" accept=".pdf,.doc,.docx,.rtf,.txt,.odt,.htm,.html" required />
      <button type="submit">Parse</button>
    </form>

    <h2>Extracted Summary</h2>
    <div id="summary">—</div>

    <h3>Raw JSON</h3>
    <pre id="json">—</pre>

    <script>
      // Pull simple items safely from RChilli schema
      function first(arr) { return Array.isArray(arr) && arr.length ? arr[0] : null; }

      document.getElementById('form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const fileInput = document.getElementById('file');
        if (!fileInput.files.length) return;

        const fd = new FormData();
        fd.append('file', fileInput.files[0]);

        const res = await fetch('/api/parse', { method: 'POST', body: fd });
        const data = await res.json();
        document.getElementById('json').textContent = JSON.stringify(data, null, 2);

        const d = data?.ResumeParserData || {};

        const name = d?.Name?.FullName || d?.Name?.FormattedName || '—';
        const email = first(d?.Email)?.EmailAddress || '—';
        const phone = first(d?.PhoneNumber)?.FormattedNumber || first(d?.PhoneNumber)?.Number || '—';

        const totalExpYears =
          d?.WorkedPeriod?.TotalExperienceInYear ||
          d?.WorkedPeriod?.TotalExperienceInYears ||
          '—';

        const skills =
          (d?.SegregatedSkill || [])
            .map(s => s?.Skill)
            .filter(Boolean)
            .slice(0, 12);

        const companies =
          (d?.SegregatedExperience || [])
            .map(x => x?.Employer?.EmployerName)
            .filter(Boolean)
            .slice(0, 6);

        document.getElementById('summary').innerHTML = `
          <p><strong>Name:</strong> ${name}</p>
          <p><strong>Email:</strong> ${email}</p>
          <p><strong>Phone:</strong> ${phone}</p>
          <p><strong>Total Experience:</strong> ${totalExpYears} years</p>
          <p><strong>Skills:</strong> ${skills.length ? skills.join(', ') : '—'}</p>
          <p><strong>Previous Companies:</strong> ${companies.length ? companies.join(', ') : '—'}</p>
        `;
      });
    </script>
  </body>
</html>
